<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>주행 후 신고사항 선택화면</title>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=ca66c24bcf740dae018b8f1511d02475"></script>
  <link rel="stylesheet" href="css/reportselect.css">
  <link rel="icon" href="imgs\logo2.png" type="image/x-icon">
</head>
<body>
  <div class="app-container">

    <!-- ✅ 상단 헤더 -->
    <header>
      <button class="back-btn" onclick="goBack()">←</button>
      <h1>새로운 위험구간 신고</h1>
      <div class="right" onclick="goNextPage()">선택완료</div>
      <div class="menu-icon">☰</div>
    </header>

    <!-- ✅ 지도 -->
    <div id="map"></div>

    <!-- ✅ 도로 결함 선택 -->
    <div class="section">
      <div class="section-title">어떤 종류의 위험구간이었는지 골라주세요.</div>
      <div class="choices">
        <div class="choice" onclick="selectChoice(this)">
          <img src="imgs/option1.svg" alt="차도와 구분 어려움">
          <div>차도와 구분 어려움</div>
        </div>
        <div class="choice" onclick="selectChoice(this)">
          <img src="imgs/option1.svg" alt="도로 융기">
          <div>도로 융기</div>
        </div>
        <div class="choice" onclick="selectChoice(this)">
          <img src="imgs/option3.svg" alt="도로 파임">
          <div>도로 파임</div>
        </div>
        <div class="choice" onclick="selectChoice(this)">
          <img src="imgs/option4.svg" alt="불법 주차">
          <div>불법 주차</div>
        </div>
        <div class="choice" onclick="selectChoice(this)">
          <img src="imgs/option5.svg" alt="공사 구간">
          <div>공사 구간</div>
        </div>
        <div class="choice" onclick="selectChoice(this)">
          <img src="imgs/option6.svg" alt="직접 입력">
          <div>직접 입력</div>
        </div>
      </div>
    </div>

  </div>

  <script src="js/report.js"></script>
  <script>
    window.onload = function () {
      const container = document.getElementById('map');

      // localStorage에서 마지막 마커 위치와 지도 레벨 가져오기
      const lastMarkerLat = localStorage.getItem('lastMarkerLat');
      const lastMarkerLng = localStorage.getItem('lastMarkerLng');
      const mapLevel = localStorage.getItem('mapLevel');

      // 기본값 설정
      const defaultLat = 37.56461040983631;
      const defaultLng = 126.93610015875485;
      const defaultLevel = 3;

      // 마지막 마커 위치가 있으면 해당 위치 사용, 없으면 기본값 사용
      const centerLat = lastMarkerLat ? parseFloat(lastMarkerLat) : defaultLat;
      const centerLng = lastMarkerLng ? parseFloat(lastMarkerLng) : defaultLng;

      // 지도 레벨이 있으면 해당 레벨 사용, 없으면 기본값 사용
      const level = mapLevel ? parseInt(mapLevel) : defaultLevel;

      const options = {
        center: new kakao.maps.LatLng(centerLat, centerLng),
        level: level
      };

      const map = new kakao.maps.Map(container, options);

      // 마커 위치 설정 (마지막 마커 위치 또는 기본값)
      const destinationPosition = new kakao.maps.LatLng(centerLat, centerLng);
      const markerImage = new kakao.maps.MarkerImage(
        "imgs/flag.png",
        new kakao.maps.Size(20, 20),
        { offset: new kakao.maps.Point(20, 40) }
      );

      const destinationMarker = new kakao.maps.Marker({
        map: map,
        position: destinationPosition,
        image: markerImage
      });
    };

    function goNextPage() {
  window.location.href = "selectmade.html";
      // 실제 구현 시 페이지 이동 로직 삽입
    }

    function selectChoice(el) {
      document.querySelectorAll('.choice').forEach(item => item.classList.remove('active'));
      el.classList.add('active');
    }

  function goNextPage() {
  const selected = document.querySelector('.choice.active');
  if (!selected) {
    alert("결함 종류를 선택해주세요.");
    return;
  }

  const damageText = selected.querySelector("div").innerText;
  const damageImg = selected.querySelector("img").src;

  localStorage.setItem("selectedDamage", damageText);
  localStorage.setItem("selectedDamageImg", damageImg);

  window.location.href = "selectmade.html"; // 선택지 반영해줌
}

function goBack() {
  window.history.back();
}
  </script>
</body>
</html>
